// event_watchdog.cc

/**************************************************************************//**
 * \file event_watchdog.cc
 * \author Sean Benish
 *****************************************************************************/

#include "event_watchdog.hh"
#include "task.h"

/*****************************************************************************
 * Constants
 *****************************************************************************/

/*****************************************************************************
 * Macros
 *****************************************************************************/

/*****************************************************************************
 * Data Types
 *****************************************************************************/

/*****************************************************************************
 * Private Function Prototypes
 *****************************************************************************/

/*****************************************************************************
 * Static Data
 *****************************************************************************/

/******************************************************************************
 * Interrupt Handlers
 *****************************************************************************/

/*****************************************************************************
 * Public Functions
 *****************************************************************************/

event_watchdog::event_watchdog(TickType_t timeout)
    : _TIMEOUT(timeout)
{}

bool event_watchdog::valid() const
{
    TickType_t now = xTaskGetTickCount();
    return valid(now);
}

bool event_watchdog::valid(TickType_t now) const
{
    return !_handler_running || (now - _handler_started) < _TIMEOUT;
}

void event_watchdog::start()
{
    TickType_t now = xTaskGetTickCount();
    _handler_started = now;
    _handler_running = true;
}

void event_watchdog::stop()
{
    _handler_running = false;
}

/*****************************************************************************
 * Private Functions
 *****************************************************************************/

// EOF
