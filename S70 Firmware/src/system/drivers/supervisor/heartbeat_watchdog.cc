// heartbeat_watchdog.cc

/**************************************************************************//**
 * \file heartbeat_watchdog.cc
 * \author Sean Benish
 *****************************************************************************/

#include "heartbeat_watchdog.hh"
#include "task.h"

/*****************************************************************************
 * Constants
 *****************************************************************************/

/*****************************************************************************
 * Macros
 *****************************************************************************/

/*****************************************************************************
 * Data Types
 *****************************************************************************/

/*****************************************************************************
 * Private Function Prototypes
 *****************************************************************************/

/*****************************************************************************
 * Static Data
 *****************************************************************************/

/******************************************************************************
 * Interrupt Handlers
 *****************************************************************************/

/*****************************************************************************
 * Public Functions
 *****************************************************************************/

heartbeat_watchdog::heartbeat_watchdog(TickType_t timeout)
    : _TIMEOUT(timeout)
{
    beat();
}

bool heartbeat_watchdog::valid() const
{
    TickType_t now = xTaskGetTickCount();
    return valid(now);
}

bool heartbeat_watchdog::valid(TickType_t now) const
{
    return (now - _last_heartbeat) < _TIMEOUT;
}

void heartbeat_watchdog::set_heartbeat_interval(TickType_t heartbeat_interval)
{
    _TIMEOUT = heartbeat_interval;
}

void heartbeat_watchdog::beat()
{
    TickType_t now = xTaskGetTickCount();
    _last_heartbeat = now;
}


/*****************************************************************************
 * Private Functions
 *****************************************************************************/

// EOF
